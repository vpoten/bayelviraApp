package elvira.tools.statistics.anova;public class probFandT {	public probFandT() {	}	public static double probF(double fr, int dn, int dd) {		double f = fr;		int a = dn;		int b = dd;		int iv=0;		double fp;		if (Math.floor(a/2) * 2 == a) {			//even numerator df			fp = L401(a,f,b,iv);			//return fp;		}		else if (Math.floor(b/2) * 2 != b) {			fp = L504(a,f,b,iv);			//return fp;		}		else {			f=1/f;			a=dd;			b=dn;			iv=1;			fp = L401(a,f,b,iv);					//return fp;		}		fp = Math.max(fp,0.0);		return fp;}public static double  probT(double t, int df) {	double F = t*t;	return probF(F,1,df);}public static double probChi(double Chisqnorm, int N1) {			double p = 0;		double AM = 1.7E-38; 		double WU2P = 2.5066282746310005;		double pr,z,SU;		int J;	 	if (Chisqnorm==0) 	 		return 1;	 				double EC = Math.exp(-Chisqnorm/2);		// IF ED<AM GOTO 1200		switch(N1) {			case 1:			 z = Math.sqrt(Chisqnorm);				pr = 1 - zdist.zprob(z);				p = 2*pr;				return p;			case 2:				p = EC;			return p;				}						double CX = Math.sqrt(Chisqnorm);		double ZC = 1.0/WU2P*EC;		int IE,I1;		double RD;		if (N1%2 == 0) {			IE = 1;			SU = ZC;			I1 = (N1-2)/2;			RD =ZC;		}		else {			IE = 0;			SU = 0;			I1 = (N1-1)/2;			RD = ZC/CX;		}		if (RD>=AM && N1<=500) {		//if ( N1<=500) {				z = CX;			    pr = 1 - zdist.zprob(z);			    			    if (IE==1)			    	 J = 2;			    else			    	J = 1;			    			    for (int i=1;i<=I1;i++) {			    	RD=RD*Chisqnorm/J;			    	J += 2;			    	SU += RD;			    }			    			    if (IE==1) {			    	p = WU2P*SU;			    				    }			    else {			    	p = 2*(pr + SU);			    				    }			   			     			}			else {								double z0= Math.pow(Chisqnorm/N1,0.333333333333333333)-1.0+2.0/(9.0*N1);				z=z0*Math.sqrt(9.0*N1/2.0);				p=1-zdist.zprob(z);							}			 return p;		}static double L504(int a,double f,int b,int iv) {	double q = a*f/(a*f+b);	double sa = Math.sqrt(q);	double sl = Math.log(sa);	double ca = Math.sqrt(1-q);	double cl = Math.log(ca);	double al = Math.atan(sa/Math.sqrt(-sa*sa+1));	double fp = 1-2*al/Math.PI;	double r=0;	double c;	int n;	if (b!=1) {		c = Math.log(2*sa/Math.PI);		fp-=Math.exp(c+cl);		if (b!=3) {			 n = (int) Math.floor((b-3)/2);			for (int i=1;i<=n;i++) {				double x = (double) (2*i+1);				r+=Math.log((x-1)/x);				double rr=r+cl*x+c;				if (rr>-78.4) {					fp-=Math.exp(rr);				}			}		}	}		if (a!=1) {		 c = r;				if (b>1) {			c+=Math.log(b-1);		}				c+=Math.log(2/Math.PI) + sl + cl*b;				if (c>-78.4) {fp+=Math.exp(c);}				if (a!=3) {			 n = (int) Math.floor((a-3)/2);			r=0;			for (int i=1;i<=n;i++) {				double x= (double) (i*2+1);				r+=Math.log((b+x-2)/x);				double rr=r+sl*(x-1)+c;				if (rr>-78.4) {fp+=Math.exp(rr);}			}		}	}		return fp;	}static double L401(int a,double f,int b,int iv) {			double q = a*f/(a*f+b);			double ql=Math.log(q);			double fp=0;			double c = Math.log(1-q)*b/2;			int n;			if (c>-78.4) {				fp = Math.exp(c);			}						if (a != 2) {			 n = (int) Math.floor(a/2-1);				double r=0;				for (int i=1;i<=n;i++) {					double x=(double) (2*i);					r+=Math.log(b+x-2)-Math.log(x) + ql;					if (r+c> -78.4) {						fp+=Math.exp(r+c);					}				 }				}								if (iv==1) {					fp = 1-fp;				}			return fp;		}	public static  double Finv(double sig, int df1, int df2) {		double [] f = new double[3];		//double sig=.05;		f[0]=1;f[1]=4;f[2]=7;		double s=3;		int index = 0;		for (int i=0;i<16;i++) {			double d=5;			//System.out.println("------ " + i);			for (int j=0;j<3;j++) {				double pdiff = Math.abs(sig -probFandT.probF(f[j],df1,df2));				if ( pdiff < d) {					d=pdiff;					index=j;					//System.out.println("d= " + d + " pdiff= " + pdiff + " index = " + index);				}			}			f[1]=f[index];			s/=2;			f[0]=f[1]-s;			f[2]=f[1]+s;			//System.out.println( f[0] + " " + f[1] + " " + f[2]);		}		return f[index];	}}